<?xml version="1.0" encoding="utf-8" ?>
<odoo>
	<record id="view_canet_maintenance_request" model="ir.ui.view">
            <field name="name">maintenance_request</field>
            <field name="model">maintenance.request</field>
            <field name="inherit_id" ref="maintenance.hr_equipment_request_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//sheet" position="attributes">
                    <attribute name="class">canet_o_form_sheet</attribute>
                </xpath>
                <button name="archive_equipment_request"  position="before" >
                        <button name="%(canet_maintenance.action_task_time_wizard_custom)d" attrs="{'invisible': [ ('state','in',['in_process','end','cancel'])]}"
                    type="action" string="Start Process" style="background-color:#4CAF50;font-color:white;" state="draft" context="{'start_process':True}"/>
                       <button name="%(canet_maintenance.action_task_time_wizard_custom)d" attrs="{'invisible': [ ('state','in',['end','draft','cancel'])]}"
                    type="action" string="Stop Process" style="background-color:#f44336;" context="{'stop_process':True}"/>
                        <button name="%(canet_maintenance.action_task_time_wizard_custom)d" attrs="{'invisible': [ ('state','in',['in_process','draft'])]}"
                    type="action" string="Restart Process"  style="background-color: #C6CB2E;" context="{'continue_process':True}"/>
                </button>
				<field name="technician_user_id" position="replace">
                    <field name="user_ids" widget="many2many_tags"/>
                     <field name="start_datetime" readonly="1"/>
                     <field name="end_datetime" invisible="1"/>
                </field>

                 <xpath
					expr="//form/sheet/div[2]"
					position="replace">
                     <label for="reference" class="oe_edit_only" string="Reference"/>
                        <h2>
                            <field name="reference" placeholder="Reference Number"/>
                        </h2>
                 </xpath>
                <field name="description" position="replace"></field>
                 <field name="stage_id" position="replace">
                        <field name="state" widget="statusbar" statusbar_visible="draft,in_process,end,cancel"/>
                 </field>
                <xpath
					expr="//form/sheet"
					position="inside">
                    <notebook>
                        <page name="parts" string="Parts">
                             <field name="operations">
                                <form string="Parts">
                                    <notebook>
                                        <page string="Maintenance Line">
                                            <group>
                                                <group>
                                                    <field name="product_id" />
                                                    <field name="name"/>
                                                    <label for="product_uom_qty"/>
                                                    <div class="o_row">
                                                        <field name="product_uom_qty"/>
                                                        <field name="product_uom" groups="product.group_uom"/>
                                                    </div>
                                                    <field name="price_unit"/>
                                                    <field name="tax_id" widget="many2many_tags" domain="[('type_tax_use','=','sale')]"/>
                                                    <field name="price_subtotal" widget="monetary" invisible="1"/>
                                                </group>
                                                <group groups="stock.group_stock_multi_locations">
                                                    <field name="location_id" domain="[('usage','not in', ['supplier','production'])]" context="{'location_id': location_id}"/>

                                                    <field name="location_dest_id" domain="[('usage','not in', ['supplier','production'])]"/>
                                                </group>
                                            </group>
                                        </page>
                                        <!--<page string="History" attrs="{'invisible':[('move_id','=', False)]}">
                                            <group>
                                                <field name="move_id" />
                                                <field name="invoice_line_id" invisible="1"/>
                                            </group>
                                        </page>-->
                                     </notebook>
                                </form>
                                <tree string="Operations" editable="bottom">
                                    <field name="product_id"/>
                                    <field name='name'/>

                                    <field name="lot_id" domain="[('product_id', '=', product_id)]" context="{'default_product_id': product_id}" groups="stock.group_production_lot"/>
                                    <field name="location_id" groups="stock.group_stock_multi_locations" domain="[('usage','not in', ['supplier','production'])]"/>
                                    <field name="location_dest_id" groups="stock.group_stock_multi_locations" domain="[('usage','not in', ['supplier','production'])]"/>
                                    <field name="product_uom_qty" string="Quantity"/>
                                    <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                                    <field name="price_unit"/>
                                    <field name="tax_id" widget="many2many_tags" domain="[('type_tax_use','=','sale')]"/>
                                    <field name="price_subtotal" widget="monetary"/>
                                </tree>
                             </field>
                            <group class="oe_subtotal_footer oe_right">
                                <field name="amount_untaxed" sum="Untaxed amount"/>
                                <field name="amount_tax"/>
                                <div class="oe_subtotal_footer_separator oe_inline">
                                    <label for="amount_total" />
                                    <button name="button_dummy"
                                         string="(update)" type="object" class="oe_edit_only oe_link"/>
                                </div>
                                <field name="amount_total" nolabel="1" sum="Total amount" class="oe_subtotal_footer_separator"/>
                            </group>
                            <div class="oe_clear"/>
                        </page>
                        <page name="time" string="Time">
                                 <field name="timesheet_ids" readonly="1">
                                <tree>
                                    <field name="employee_id"/>
                                    <field name="name"/>
                                    <field name="time"/>
                                </tree>
                                </field>
                        </page>
                        <page name="note" string="Note">
                            <field name="description"/>
                        </page>

                    </notebook>
                 </xpath>

            </field>
        </record>

         <record id="view_canet_maintenance_request_tree" model="ir.ui.view">
            <field name="name">maintenance_request</field>
            <field name="model">maintenance.request</field>
            <field name="inherit_id" ref="maintenance.hr_equipment_request_view_tree"/>
            <field name="arch" type="xml">
                    <field name="stage_id" position="replace">
                        <field name="state"/>
                    </field>
            </field>
         </record>

         <record id="view_canet_maintenance_request_kanban" model="ir.ui.view">
            <field name="name">maintenance_request</field>
            <field name="model">maintenance.request</field>
            <field name="inherit_id" ref="maintenance.hr_equipment_request_view_kanban"/>
            <field name="arch" type="xml">
                    <kanban position="replace">
                        <kanban default_group_by="state">
                            <field name="state"/>
                            <field name="color"/>
                            <field name="priority"/>
                            <field name="equipment_id"/>
                            <field name="technician_user_id"/>
                            <field name="owner_user_id"/>
                            <field name="category_id"/>
                            <field name="kanban_state"/>
                            <field name="message_needaction_counter"/>
                            <field name="activity_ids" />
                            <field name="activity_state" />
                            <templates>
                                <t t-name="kanban-tooltip">
                                   <ul class="oe_kanban_tooltip">
                                      <li><b>Category:</b> <field name="category_id"/></li>
                                      <li><b>Request to:</b> <field name="technician_user_id"/></li>
                                   </ul>
                                </t>
                                <t t-name="kanban-box">
                                    <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click oe_semantic_html_override">
                                        <div class="o_dropdown_kanban dropdown">

                                            <a class="dropdown-toggle btn" data-toggle="dropdown" href="#" >
                                                <span class="fa fa-ellipsis-v"/>
                                            </a>
                                            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                                <t t-if="widget.editable"><li><a type="edit">Edit...</a></li></t>
                                                <t t-if="widget.deletable"><li><a type="delete">Delete</a></li></t>
                                                <li><ul class="oe_kanban_colorpicker" data-field="color"/></li>
                                            </ul>
                                        </div>
                                        <div class="oe_kanban_content" tooltip="kanban-tooltip">
                                            <div class="o_kanban_record_top">
                                                <b class="o_kanban_record_title"><field name="name"/></b>
                                            </div>
                                            <div class="o_kanban_record_body">
                                                <span name="owner_user_id" t-if="record.owner_user_id.raw_value">Requested by : <field name="owner_user_id"/><br/></span>
                                                <span name="technician_user_id" t-if="record.technician_user_id.raw_value">Responsible : <field name="technician_user_id"/><br/></span>
                                                <span class="oe_grey" t-if="record.equipment_id.raw_value"><field name="equipment_id"/><br/></span>
                                                <span t-if="record.category_id.raw_value"><field name="category_id"/></span>
                                            </div>
                                            <div class="o_kanban_record_bottom">
                                                <div class="oe_kanban_bottom_left">
                                                    <field name="priority" widget="priority"/>
                                                    <t t-if="record.message_needaction_counter.raw_value">
                                                        <span class='oe_kanban_mail_new' title='Unread Messages'><i class='fa fa-comments'/><t t-raw="record.message_needaction_counter.raw_value"/></span>
                                                    </t>
                                                    <div class="o_kanban_inline_block ml4 mr4">
                                                        <field name="activity_ids" widget="kanban_activity" />
                                                    </div>
                                                </div>
                                                <div class="oe_kanban_bottom_right">
                                                    <field name="kanban_state" widget="state_selection"/>
                                                    <img t-att-src="kanban_image('res.users', 'image_small', record.technician_user_id.raw_value)" t-att-title="record.technician_user_id.value" width="24" height="24" class="oe_kanban_avatar pull-right"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="oe_clear"></div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </kanban>
            </field>
         </record>
</odoo>
